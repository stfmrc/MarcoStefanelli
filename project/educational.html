<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ongoing-projects</title>
    <!-- Link to CSS -->
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/educational.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
    <script>
        window.MathJax = {
          tex: {
            displayMath: [['\\[', '\\]'], ['\\(', '\\)']]
          },
          svg: {
            scale: 1
          },
          options: {
            renderActions: {
              addMenu: []
            }
          }
        };
        </script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body class="educational"> <!-- Added class here -->
    <br><br>
    <br><br>
    <header>
        <h1>A collection of interactive applications designed to support learning about climate change, weather forecasting, and data assimilation</h1>
    </header>

    <main>
        <p>This page hosts a collection of <strong>interactive applications</strong> designed to support learning about <strong>climate change</strong>, 
            <strong>weather forecasting</strong>, and <strong>data assimilation</strong>. These tools are tailored for both <strong>high school</strong> 
            and <strong>university-level</strong> lectures, making complex scientific concepts more accessible and engaging for students.</p>
    
        <ul class="tool-list">
            <li>
                <details>
                    <summary>Lorenz63 and Data Assimilation Tool</summary>
                    <a href="../tools/1_lorenz-3dvar-project.zip" download>
                        <button>Download Tool</button>
                    </a>
                    <p>
                        This tool is designed for educational purposes and it is useful for understanding chaotic systems and 
                        how forecasts can be improved by assimilating observations. 
                        It integrate the Lorenz63 model and applies a data assimilation technique. 
                        <br><br>
                        The Lorenz63 model is a simplified system that exhibits chaotic behavior, 
                        making it a suitable example for studying the impact of initial conditions on forecasts. 
                        It consists of the following three ordinary differential equations 
                        <p>
                            \[
                            \begin{aligned}
                            \frac{dx}{dt} &= \sigma (y - x) \\
                            \frac{dy}{dt} &= x (\rho - z) - y \\
                            \frac{dz}{dt} &= xy - \beta z
                            \end{aligned}
                            \]
                        </p>
                        
                        The model describes the idealized motion of fluid convection, 
                        and it shows how small differences in the initial state can lead to drastically different outcomes over time.
                        In the field of weather forecasting, this sensitivity to initial conditions is a challenge for making accurate long-term predictions. 
                        For these reasons, the Lorenz63 model is a classic example used to illustrate the concepts of chaos theory and the limitations of weather forecasting.
                        Edward Lorenz coined the term "butterfly effect" during a 1972 conference in Washington, D.C., to describe the Lorenz63 model's sensitivity to initial conditions.
                        <br><br>
                        The tool allows users to interact with the Lorenz63 model and observe the forecast evolution over time.
                        Model parameters, and initial conditions, can be modified to observe the impact on the forecast. 
                        The model integration is showed on an animation 
                        where in red is the true state and in blue the forecast. Modifying the initial conditions of the forecast, 
                        the user can see how the forecast diverge from the true state when the model integration goes far from initial conditions. 
                        The model parameters can also be modified.
                        <br><br>
                        The data assimilation part of the tool allows the user to assimilate observations into the model to improve the forecast.
                        The observations are computed as perturbation of the true state, randomly adding or subtracting σ<sub>obs</sub>. 
                        The user can modify the σ<sub>obs</sub> and observation step to see the impact on the forecast.
                        The data assimilation technique used is a simplified version of the Kalman Filter (1DKF), where the Kalman gain is defined as 

                        \[
                         K = \frac{\sigma^2_{\text{model}}}{\sigma^2_{\text{model}} + \sigma^2_{\text{obs}}} 
                        \]

                        The user can also modify σ<sub>model</sub> to directly modify the Kalman gain.

                        The analysis equations for the Lorenz63 components are:

                        \[
                        \begin{aligned}
                        x_a &= x_f + K (x_o - x_f)\\
                        y_a &= y_f + K (y_o - y_f)\\
                        z_a &= z_f + K (z_o - z_f)
                        \end{aligned}
                        \]

                        which are used to compute the analysis and update the initial conditions of the next forecast step. 
                        The user can see how the forecast is updated with the observations and how the forecast is closer to the true state when data assimilation is used.
                        <br><br>
                        <br><br>

                        Questions for students are:
                        <br><br>
                        <ul>
                            <li>What is the difference between the true state and the forecast state?</li>
                            <li>Why can't we forecast the true state in real applications?</li>
                            <li>Why can't we have accurate weather forecasts for more than 4-5 days?</li>
                            <li>How does the forecast improve when assimilating observations?</li>
                            <li>What is the impact of observation error on the analysis and consequently on the forecast?</li>
                            <li>What is the impact of the observation step on the analysis and consequently on the forecast?</li>
                            <li>What happens if σ<sub>model</sub> >> σ<sub>obs</sub>?</li>
                            <li>What happens if σ<sub>obs</sub> >> σ<sub>model</sub>?</li>
                            <li>What happens if σ<sub>obs</sub> = σ<sub>model</sub>?</li>
                            <li>Why is Data Assimilation useful in weather forecasting?</li>
                            <li>Could you provide other applications that could benefit from Data Assimilation?</li>
                        </ul>

                        <br><br>
                        HOW TO USE THE TOOL:
                    </p>Download the tool and unzip it. Open the folder and click on the executable file named index.html.
                        The tool will open in your browser.</p>
                        
                        


                    </p>
                    <a href="../tools/1_lorenz-3dvar-project.zip" download>
                        <button>Download Tool</button>
                    </a>
                </details>
            </li>
    
        </ul>
    </main>


    <footer>
        <p>&copy; 2025 Marco Stefanelli</p>
    </footer>
    <a href="../index.html">⬅️</a>
    <script>
        // Function to get current date and time in 'yyyy-mm-dd HH:mm:ss' format
        function getCurrentDateTime() {
            const now = new Date();
            const date = now.toISOString().split('T')[0]; // Extracts 'yyyy-mm-dd' from ISO format
            const time = now.toTimeString().split(' ')[0]; // Extracts 'HH:mm:ss' from time string
            return `${date} ${time}`; // Combine both date and time
        }
    
        // Generate a unique key for the page based on the URL or a custom identifier
        function getPageKey() {
            return window.location.pathname; // You can customize this if needed (e.g., use specific page IDs or URLs)
        }
    
        // Retrieve the page-specific counter and logs from localStorage
        const pageKey = getPageKey(); // Use the URL path as a unique key for each page
        let pageViewCount = parseInt(localStorage.getItem(`${pageKey}-pageViewCount`), 10) || 0;
        const todayDateTime = getCurrentDateTime(); // Get current date and time
    
        // Increment the page view count
        pageViewCount++;
    
        // Save the updated count back to localStorage (specific to this page)
        localStorage.setItem(`${pageKey}-pageViewCount`, pageViewCount);
    
        // Retrieve previous log entries for this page from localStorage (if any)
        let logEntries = localStorage.getItem(`${pageKey}-logEntries`);
        if (!logEntries) {
            logEntries = '';  // Initialize an empty log if no entries exist
        }
    
        // Function to generate and download the log file for the current page
        function downloadLogFile() {
            // Ask for a password to protect the download and reset the counter
            const passwordPrompt = prompt('Enter the password to download the log file.\n\nType "reset" to reset the counter and logs.');
            
            const correctPassword = '3.1415926'; // Change this to your desired password
    
            // If the user typed "reset", prompt for password to reset
            if (passwordPrompt === 'reset') {
                const resetPassword = prompt("Enter the password to reset the counter and logs:");
                // Check if the entered password for reset is correct
                if (resetPassword !== correctPassword) {
                    alert('Incorrect password for reset!');
                    return;  // Exit if the password is incorrect
                }
    
                // If the password for reset is correct, confirm reset
                if (confirm("Are you sure you want to reset the counter and clear all log entries?")) {
                    // Reset the page view count and log entries for this page
                    localStorage.setItem(`${pageKey}-pageViewCount`, 0);
                    localStorage.setItem(`${pageKey}-logEntries`, '');
    
                    // Reload the page to reflect the reset (optional)
                    location.reload(); // This refreshes the page to reset the display
                }
                return;  // Exit after the reset logic
            }
    
            // Check if the entered password for download is correct
            if (passwordPrompt !== correctPassword) {
                alert('Incorrect password!');
                return;  // Exit if the password is incorrect
            }
    
            // Create the new log entry with date, time, and page view count
            const newLogEntry = `Date and Time: ${todayDateTime}\nPage View Count: ${pageViewCount}\n`;
    
            // Prepend the new entry to the existing log entries
            logEntries = newLogEntry + logEntries;
    
            // Save the updated log entries back to localStorage for this page
            localStorage.setItem(`${pageKey}-logEntries`, logEntries);
    
            // Create the log file content (concatenating all previous entries)
            const logContent = logEntries;
    
            // Create a Blob from the log content
            const blob = new Blob([logContent], { type: 'text/plain' });
    
            // Create an object URL for the Blob
            const url = URL.createObjectURL(blob);
    
            // Create a link element to trigger the download
            const a = document.createElement('a');
            a.href = url;
            a.download = `${pageKey}-page-view-log.txt`; // Use the page-specific filename
            document.body.appendChild(a);
            a.click(); // Trigger the download
            document.body.removeChild(a);
    
            // Revoke the object URL after download
            URL.revokeObjectURL(url);
        }
    
        // Ensure the DOM is fully loaded before attaching the event listener
        document.addEventListener('DOMContentLoaded', function () {
            // Add event listener for clicking on the footer to download the log
            document.querySelector('footer').addEventListener('click', downloadLogFile);
        });
    </script>
</body>
</html>
